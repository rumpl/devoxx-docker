<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discovering cgroups Configuration</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/prism.css">
</head>
<body>
    <header>
        <h1>Discovering cgroups Configuration</h1>
        <a href="/" class="home-link">‚Üê Back to Index</a>
    </header>
    <main>
        <article class="markdown-content">
            <h1>Discovering cgroups Configuration</h1>
<h2>Objective</h2>
<p>In this exercise, you will learn how to configure cgroups to limit memory and
CPU usage for a process. You will focus on setting <code>memory.max</code>, <code>cpu.max</code>, and
adding the process to <code>cgroup.procs</code>.</p>
<h2>Steps</h2>
<h3>Step 1: Setup cgroups</h3>
<ol>
<li>Create a new directory for the cgroup:</li>
</ol>
<pre><code class="language-go">cgroupPath := &quot;/sys/fs/cgroup/devoxx-container&quot;
if err := os.Mkdir(cgroupPath, 0755); err != nil {
    log.Fatalf(&quot;Failed to create cgroup directory: %v&quot;, err)
}
</code></pre>
<h3>Step 2: Configure Memory Limit</h3>
<ol>
<li>Set the memory limit to 100MB:</li>
</ol>
<pre><code class="language-go">if err := os.WriteFile(cgroupPath+&quot;/memory.max&quot;, []byte(&quot;104857600&quot;), 0644); err != nil {
    log.Fatalf(&quot;Failed to set memory limit: %v&quot;, err)
}
</code></pre>
<h3>Step 3: Configure CPU Limit</h3>
<ol>
<li>Set the CPU limit to 50ms per 100ms:</li>
</ol>
<pre><code class="language-go">if err := os.WriteFile(cgroupPath+&quot;/cpu.max&quot;, []byte(&quot;50000 100000&quot;), 0644); err != nil {
    log.Fatalf(&quot;Failed to set CPU limit: %v&quot;, err)
}
</code></pre>
<h3>Step 4: Add Process to cgroup</h3>
<ol>
<li>Add the process to the cgroup:</li>
</ol>
<pre><code class="language-go">if err := os.WriteFile(cgroupPath+&quot;/cgroup.procs&quot;, []byte(strconv.Itoa(pid)), 0644); err != nil {
    log.Fatalf(&quot;Failed to add process to cgroup: %v&quot;, err)
}
</code></pre>
<h3>Step 5: Run the Program</h3>
<ol>
<li>
<p>Compile and run the Go program.</p>
<ul>
<li>Save the code in a file named <code>main.go</code>.</li>
<li>Open a terminal and navigate to the directory containing <code>main.go</code>.</li>
<li>Run the following commands to compile and execute the program:
<pre><code class="language-sh">go build -o devoxx-cgroup
sudo ./devoxx-cgroup
</code></pre>
</li>
</ul>
</li>
<li>
<p>Observe the output to see the cgroup configuration and how it limits the
process resources.</p>
</li>
</ol>
<p><a href="./04-namespace-and-chroot.html">Previous step</a> <a href="06-volumes.html">Next step</a></p>
<h2>Hints</h2>
<ul>
<li>Use the <code>os.Mkdir</code> function to create the cgroup directory.</li>
<li>Use the <code>os.WriteFile</code> function to configure <code>memory.max</code>, <code>cpu.max</code>, and
<code>cgroup.procs</code>.</li>
</ul>
<h2>Key Points</h2>
<ul>
<li>Understand how to configure cgroups to limit memory and CPU usage.</li>
<li>Learn how to use the <code>os</code> package in Go to manipulate cgroups.</li>
<li>Observe the effect of cgroup configuration on process resource usage.</li>
</ul>
<h2>Additional Resources</h2>
<ul>
<li><a href="https://man7.org/linux/man-pages/man7/cgroups.7.html">man cgroups</a></li>
<li><a href="https://pkg.go.dev/os">Go os package documentation</a></li>
</ul>

        </article>
    </main>
    <footer>
        <p>Generated with Markdown Server</p>
    </footer>
    <script src="/static/prism.js"></script>
</body>
</html>